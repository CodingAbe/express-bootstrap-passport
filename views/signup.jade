//- http://twitter.github.com/bootstrap/base-css.html#forms
//- https://github.com/visionmedia/jade
extends layout

block content
  div.container
    //- 
      div.row
        div.span12
          div.well
            div.social_buttons
              div.inset
                a.fb.login_button(href="/facebook/?next=%2F")
                  div.logo_wrapper
                    span.logo
                      span Login with Facebook
              div.inset
                a.tw.login_button(href="/twitter/?next=%2F")
                  div.logo_wrapper
                    span.logo
                      span Login with Twitter

    div.row
      div.span5.offset2
        
        //- set focus for the user headjs version
        script 
          head.ready(function() {
             $("#inputUserName").focus();
             $("#hint").css('display', 'none');
             $(function () { $("input").not("[type=submit]").jqBootstrapValidation(); } );
          });

        //- check entered email
        script
          head.ready(function() {
            
            var $email = $('#inputEmail');
            var $hint = $("#hint");

            $email.on('blur', function() {
              $hint.css('display', 'none').empty();
              $(this).mailcheck({
                suggested: function(element, suggestion) {
                  if(!$hint.html()) {
                    // First error - fill in/show entire hint element
                    var suggestion = "Did you mean <span class='suggestion'>" +
                                      "<span class='address'>" + suggestion.address + "</span>"
                                      + "@<a href='#' class='domain'>" + suggestion.domain + 
                                      "</a></span>?";
                                      
                    $hint.html(suggestion).fadeIn(150);
                  } else {
                    // Subsequent errors
                    $(".address").html(suggestion.address);
                    $(".domain").html(suggestion.domain);
                  }
                },
                  empty: function(element) {
                  // callback code
                }
              });
            });

            $hint.on('click', '.domain', function() {
              // On click, fill in the field with the suggestion and remove the hint
              $email.val($(".suggestion").text());
              $hint.fadeOut(200, function() {
                $(this).empty();
              });
              $("#inputPassword").focus();
              return false;
            });

          });

        //- set focus for the user regular version
          script $(document).ready(function () { $("#inputUserName").focus(); })

        //- Signup Form
        br 
        br 
        form.form-horizontal(action='/register', method='post')
          fieldset
            Legend Sign up!
            div.control-group
                label.control-label(for='inputUserName') Your Name
                div.controls
                  input#inputUserName.input-large(name='username', data-validation-ajax-ajax='/json/username', type='text', placeholder='Username', required)
                  //input#inputUserName.input-large(name='username', type='text', placeholder='Username', required)         
              div.control-group
                label.control-label(for='inputEmail') Email
                div.controls
                  input#inputEmail.input-large(name='email', type='email', placeholder='you@youremail.com', required)
                  //- For mailcheck
                  div#hint  
              div.control-group
                label.control-label(for='inputPassword') Password
                div.controls
                  input#inputPassword.input-large(name='password', minlength="6", type='password', placeholder='Passw0rd', required)
              div.control-group
                div.controls
                  button.btn(type='submit') Sign Up

        //- Flash Message
        if (message != '')
          div.alert.alert-error
            p !{message}
        
        p Already have an account? 
          a(href="/login") Sign In